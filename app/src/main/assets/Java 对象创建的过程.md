### 链接

<https://troywu0.gitbooks.io/spark/content/java%E5%AF%B9%E8%B1%A1%E5%88%9B%E5%BB%BA%E7%9A%84%E8%BF%87%E7%A8%8B.html>

---

### JAVA对象创建的过程

1. 虚拟机遇到new指令时，首先先去检查这个指令的参数是否能在常量池中定位到一个类的符号引用，并且检查这个符号引用代表的类是否已被加载、解析和初始化过。如果没有，就执行类加载过程。
2. 为对象分配空间，把一块固定大小的内存从java堆里划分出来。如果java堆是那种齐整的，一边放已经用的内存，另一边放没有用的内存，这样就有一个中间指针隔开两个区域，只要把这个指针移动到相应位置即可，这种方法叫做“指针碰撞”。如果已使用内存和未使用内存交错，就需要一个“空闲列表”方法来决定分配在哪里。
3. 多线程并发时会出现正在给对象A分配内存，还没来得急修改指针，对象B又用这个指针分配内存，这样就出现问题了。解决这种问题有两种方案：1.对分配内存空间的动作进行同步；2.把内存分配动作按照线程划分在不同的空间之中进行，即每个线程在java对中预先分配一小块内存成为本地线程分配缓冲（Thread Local Allocation Buffer, TLAB）。可以通过-XX:+/-UseTLAB参数决定
4. 内存分配完之后虚拟机将分配到的内存全都初始化为零值。接下来设置对象头，包括这个对象时哪个类的实例，如何才能找到该类的元数据信息，对象的哈希码，对象的GC分代年龄等信息。
5. 执行init方法，初始化

### 对象的内存布局

* 对象头：对象头包括两部分信息，第一部分是存储对象自身的运行时数据，如哈希码，GC分代年龄，锁状态标志，线程持有的锁等等。第二部分是类型指针，即对象指向类元数据的指针。
* 实例数据：就是数据啦
* 对齐填充：不是必然的存在，就是为了对齐的嘛
